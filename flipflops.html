<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flip-flop</title>
</head>
<body onload="startdraw()" >
    <form name="valaszt" method="get" enctype="text/plain">
        <h1>Tároló áramkörök (Flip-flop, Latch) működése</h1>
    
        <h3>Tároló típusa</h3> 
        <select name="tarolo" size="1" onchange="flipflopType()">
                <option value="SR" selected>SR Latch</option>
                <option value="DG">DG Latch</option>
                <option value="JK">JK flip-flop</option>
                <option value="TC">T flip-flop</option>
                <option value="DC">D flip-flop</option>		
        </select>
        <p> </p>
        <br>		
    </form>		
    <canvas width="700" height="600" id="drawsheet" onclick="clickCanv(event)" style="border:2px solid#c3c3c3;background-color: #f1f1f1;">
    A HTML5 canvas nem támogatott! </canvas>
      
    <script LANGUAGE="JavaScript">
 
    var canv1;
    var draw1;
    var fftype="SR";
      
    var myFlipflop;
        
        
    //*********************************************************************************
        
    function startdraw()
    {
            canv1 = document.getElementById("drawsheet");
            draw1 = canv1.getContext("2d");
        
           
            myFlipflop = new FlipflopSR(0,0,300,300);		// tároló létrehozása
            myFlipflop.draw(draw1);
            
    }
        
    //*********************************************************************************
        
    function flipflopType()
     {
        fftype=document.valaszt.tarolo.value;	// kiválasztott tároló típus

        if(fftype == "SR")
            myFlipflop = new FlipflopSR(0,0,300,300);
	    else if(fftype == "DG")
            myFlipflop = new FlipflopDG(0,0,300,300);
        else if(fftype == "DC")
            myFlipflop = new FlipflopDC(0,0,300,300);   
      
        myFlipflop.draw(draw1);
    }  
        
    //*********************************************************************************
        
    function clickCanv()
    {

    }     

 
    //*********************************************************************************

	class FlipflopSR{
         constructor(x,y,w,h){    
	    // SR  tároló rajzolása, számolása
	    //  x,y  kezdő koordináták (bal-felső sarok)
	    // w - szélesség,  h - magasság
	    //  optimális terület ->  300*300
	       
            var xu; 
            var yu;
        
            xu = w/100;
            yu = h/100;
            if(xu<yu) this.du = xu;       // du -->  drawn unit  !!
            else this.du = yu;
		    this.x = x;
		    this.y = y;
		    this.width = w;
		    this.height = h;
		    this.type = "SR";
            this.title = "SR tároló  (SR latch)";
            this.S = 0;     // input-S
            this.R = 0;     // input-R
            this.Q = 0;     // output-Q, present state
            this.nextQ = 0;     // next state, 
	    
	     }
	     

	     draw(sheet)
	     {
            var du=this.du;     // drawing unit
	
            // canvas  x,y coordinates translate
            sheet.translate(this.x, this.y);
            sheet.clearRect(0,0,this.width,this.height);

            this.drawFlipflop(sheet,du); // basic flipflop image
	        
	        // input, output label
	        sheet.fillStyle = "#221999";
            sheet.fillText(this.type[0],42*du,44*du);
 	        sheet.fillText(this.type[1],42*du,74*du);
            sheet.fillText("Q",60*du,44*du);

            sheet.translate(0,0);  // canvas  x,y coordinates reset
          }


        drawFlipflop(sheet,du)
          {

            // style
            sheet.textBaseline = "bottom";
            sheet.textAlign = "left";
	        sheet.lineWidth=3;
	        sheet.strokeStyle="#FF0000";	
            sheet.fillStyle="#FF0000";
 	        sheet.font="25px Arial";
 	
            // flipflop name label
            sheet.fillText(this.title,10*du,15*du);

            // drawing flipflop
            {
	            sheet.strokeRect(40*du,30*du,30*du,50*du);      // flipflop rectangle
                this.drawLine(sheet,25*du,40*du,40*du,40*du);   //  input_1  
                this.drawLine(sheet,25*du,70*du,40*du,70*du);   //  input_2
                
                this.drawLine(sheet,70*du,40*du,85*du,40*du);   // output  Q
                this.drawLine(sheet,76*du,70*du,85*du,70*du);   // output  not_Q

                sheet.beginPath();
                sheet.arc(73*du,70*du,3*du,0,2*Math.PI);        // negation circle
                sheet.closePath();
                sheet.stroke();

	        }



          }


        drawLine(sheet,x1,y1,x2,y2)
	      {
                sheet.beginPath();
		        sheet.moveTo(x1,y1);
		        sheet.lineTo(x2,y2);      
		        sheet.closePath();	
                sheet.stroke();
           }

        // calculation of next state of flipflop
        calc() 
          {
                //  SR latch, dominantly Reset
            this.nextQ = this.S && !this.R || !this.R && this.Q;
            this.Q = this.nextQ;

          }

    }


    //*********************************************************************************

    class FlipflopDG extends FlipflopSR {
        // DG  tároló rajzolása, számolása
	    //  x,y  kezdő koordináták (bal-felső sarok)
	    // w - szélesség,  h - magasság

        constructor(x,y,w,h) {
            super(x,y,w,h);
            this.type = "DG";
            this.title = "DG tároló  (D latch)";
            this.D = 0;     // input-D
            this.G = 0;     // input-G

        }


         // calculation of next state of flipflop
        calc() 
          {
                //  DG latch
            this.nextQ = this.D && this.G || this.D && this.Q || !this.G && this.Q;
            this.Q = this.nextQ;

          }

    }


    //*********************************************************************************

    class FlipflopDC extends FlipflopSR {
        // D tároló rajzolása, számolása
        //  positive edge controll D flipflop
	    //  x,y  kezdő koordináták (bal-felső sarok)
	    // w - szélesség,  h - magasság

        constructor(x,y,w,h) {
            super(x,y,w,h);
            this.type = "DC";
            this.title = "D tároló  (D flipflop)";
            this.D = 0;     // input-D
            this.C = 0;     // input-clock
            this.Cnext = 0;     // input-clock next
        }


         // calculation of next state of flipflop
        calc() 
          {
                // D flipflop, pozitív élvezérelt
            if(this.Cnext == 1 && this.C == 0)
               { this.nextQ = this.D;  }
            else
               { this.nextQ = this.Q;  }
            this.Q = this.nextQ;

          }

        draw(sheet)
	     {
            var du=this.du;     // drawing unit
	
            // canvas  x,y coordinates translate
            sheet.translate(this.x, this.y);
            sheet.clearRect(0,0,this.width,this.height);

            this.drawFlipflop(sheet,du); // basic flipflop image

            this.drawLine(sheet,40*du,68*du,45*du,70*du);   //  edge clock drawing mark
            this.drawLine(sheet,40*du,72*du,45*du,70*du);   // edge clock drawing mark
	        
	        // input, output label
	        sheet.fillStyle = "#221999";
            sheet.fillText(this.type[0],42*du,44*du);
 	        sheet.fillText(this.type[1],47*du,74*du);       // letter right shift  !!
            sheet.fillText("Q",60*du,44*du);

            sheet.translate(0,0);  // canvas  x,y coordinates reset
          }



    }

  

</script>

</body>
</html>
